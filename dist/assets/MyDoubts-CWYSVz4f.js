import{r as a,s as d,j as e,S as f,g as D}from"./index-CHjF_dAl.js";import{D as P}from"./DashboardLayout-Dnq7Jnl_.js";const Q=3e3,H=o=>{const b=new Date,u=new Date(o),i=Math.floor((b-u)/1e3);return i<10?"just now":i<60?`${i}s ago`:i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:i<604800?`${Math.floor(i/86400)}d ago`:u.toLocaleDateString()},ee=()=>{const[o,b]=a.useState([]),[u,i]=a.useState(!0),[r,g]=a.useState(null),[j,m]=a.useState([]),[x,p]=a.useState(""),[O,S]=a.useState(!1),[w,Y]=a.useState("all"),[q,V]=a.useState([]),[y,C]=a.useState(!1),[_,K]=a.useState(!1),R=a.useRef(null),N=a.useRef(null),T=a.useRef(null),v=a.useRef(null),$=a.useRef(null),A=a.useRef(0);a.useEffect(()=>{$.current=r},[r]);const h=a.useCallback((t=!0)=>{R.current?.scrollIntoView({behavior:t?"smooth":"instant"})},[]),z=a.useCallback(()=>{const t=N.current;if(!t)return;const s=t.scrollHeight-t.scrollTop-t.clientHeight<80;K(!s)},[]),B=async()=>{i(!0);const t=await d.getDoubts();t.success&&b(t.doubts||[]),i(!1)},F=async()=>{const t=await d.getCourses();t.success&&V(t.courses||[])};a.useEffect(()=>{B(),F()},[]);const k=a.useCallback(async()=>{const t=$.current;if(t)try{const s=await d.getDoubt(t.id);if(s.success){const l=s.replies||[];m(n=>{if(l.length!==n.length||JSON.stringify(l.map(c=>c.id))!==JSON.stringify(n.map(c=>c.id))){const c=N.current;return(!c||c.scrollHeight-c.scrollTop-c.clientHeight<80)&&setTimeout(()=>h(),50),l}return n}),s.doubt&&g(s.doubt)}}catch{}},[h]);a.useEffect(()=>(r&&(v.current=setInterval(k,Q)),()=>{v.current&&clearInterval(v.current)}),[r?.id,k]);const J=async t=>{S(!0),g(t),m([]),p(""),A.current=0;const s=await d.getDoubt(t.id);s.success&&(g(s.doubt),m(s.replies||[]),A.current=(s.replies||[]).length,setTimeout(()=>h(!1),100)),S(!1)},U=async()=>{const{value:t}=await f.fire({...D(),title:"Ask a Doubt",html:`
        <select id="swal-course" class="swal2-select" style="width:100%;margin-bottom:8px">
          <option value="">Select Course (Optional)</option>
          ${q.map(s=>`<option value="${s.id}">${s.title}</option>`).join("")}
        </select>
        <input id="swal-title" class="swal2-input" placeholder="Doubt Title *" style="width:100%">
        <textarea id="swal-desc" class="swal2-textarea" placeholder="Describe your doubt in detail..." style="width:100%"></textarea>
        <select id="swal-priority" class="swal2-select" style="width:100%">
          <option value="low">Low Priority</option>
          <option value="medium" selected>Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
      `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Submit Doubt",confirmButtonColor:"#d4a574",preConfirm:()=>{const s=document.getElementById("swal-title").value;return s?{courseId:document.getElementById("swal-course").value||null,title:s,description:document.getElementById("swal-desc").value,priority:document.getElementById("swal-priority").value}:(f.showValidationMessage("Doubt title is required"),!1)}});if(t){const s=await d.createDoubt(t);s.success?(f.fire({...D(),icon:"success",title:"Doubt Posted!",text:"A mentor will respond soon.",timer:2e3,showConfirmButton:!1}),B()):f.fire({...D(),icon:"error",title:"Error",text:s.message})}},E=async()=>{if(!x.trim()||!r||y)return;const t=x.trim();p(""),C(!0);const s={id:`temp-${Date.now()}`,authorName:"You",authorRole:"student",content:t,createdAt:new Date().toISOString(),_sending:!0};m(n=>[...n,s]),setTimeout(()=>h(),50);const l=await d.replyDoubt(r.id,{content:t});C(!1),l.success?k():(m(n=>n.filter(c=>c.id!==s.id)),p(t)),T.current?.focus()},G=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),E())},I=t=>({open:"bg-amber-100 text-amber-800 dark-theme:bg-amber-900/30 dark-theme:text-amber-300","in-progress":"bg-blue-100 text-blue-800 dark-theme:bg-blue-900/30 dark-theme:text-blue-300",resolved:"bg-green-100 text-green-800 dark-theme:bg-green-900/30 dark-theme:text-green-300",closed:"bg-gray-100 text-gray-800 dark-theme:bg-gray-700 dark-theme:text-gray-300"})[t]||"bg-gray-100 text-gray-800",M=t=>({high:"text-red-500",medium:"text-amber-500",low:"text-green-500"})[t]||"text-gray-500",L=w==="all"?o:o.filter(t=>t.status===w);return r?e.jsxs(P,{children:[e.jsx("style",{children:`
          @keyframes msgSlideIn {
            from { opacity: 0; transform: translateY(12px) scale(0.97); }
            to { opacity: 1; transform: translateY(0) scale(1); }
          }
          .chat-msg { animation: msgSlideIn 0.25s ease-out both; }
          .chat-msg-sending { opacity: 0.7; }
          @keyframes dotPulse {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
          }
          .typing-dot { animation: dotPulse 1.4s infinite ease-in-out both; }
          .typing-dot:nth-child(2) { animation-delay: 0.16s; }
          .typing-dot:nth-child(3) { animation-delay: 0.32s; }
          @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
          }
          .live-dot { animation: livePulse 2s infinite; }
        `}),e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col",style:{height:"calc(100vh - 7rem)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("button",{onClick:()=>g(null),className:"flex items-center gap-2 text-primary hover:text-primary-dark font-medium transition",children:[e.jsx("i",{className:"ri-arrow-left-line text-lg"})," Back"]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs text-gray-400 dark-theme:text-gray-500",children:[e.jsx("span",{className:"live-dot inline-block w-2 h-2 rounded-full bg-green-500"}),"Live"]})]}),O?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("i",{className:"ri-loader-4-line animate-spin text-2xl text-primary"})})}):e.jsxs("div",{className:"flex-1 flex flex-col bg-white dark-theme:bg-gray-800 rounded-xl shadow-lg overflow-hidden min-h-0",children:[e.jsxs("div",{className:"px-5 py-4 border-b dark-theme:border-gray-700 bg-white/80 dark-theme:bg-gray-800/80 backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark-theme:text-gray-100 truncate",children:r.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500 dark-theme:text-gray-400 flex-wrap",children:[r.courseTitle&&e.jsxs("span",{className:"text-primary",children:[e.jsx("i",{className:"ri-book-open-line mr-1"}),r.courseTitle]}),r.mentorName&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-user-star-line mr-1"}),r.mentorName]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-time-line mr-1"}),H(r.createdAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${I(r.status)}`,children:r.status}),e.jsx("span",{className:M(r.priority),children:e.jsx("i",{className:"ri-flag-fill"})})]})]}),r.description&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark-theme:text-gray-400 line-clamp-2",children:r.description})]}),e.jsxs("div",{ref:N,onScroll:z,className:"flex-1 overflow-y-auto px-5 py-4 space-y-3 relative",style:{scrollBehavior:"smooth"},children:[j.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 dark-theme:text-gray-500",children:[e.jsx("i",{className:"ri-chat-smile-3-line text-5xl mb-3 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"No replies yet"}),e.jsx("p",{className:"text-xs mt-1",children:"A mentor will respond soon — you'll see it appear here live"})]}):e.jsx(e.Fragment,{children:j.map((t,s)=>{const l=t.authorRole==="student",n=s===0||j[s-1]?.authorRole!==t.authorRole;return e.jsxs("div",{className:`flex ${l?"justify-end":"justify-start"} chat-msg ${t._sending?"chat-msg-sending":""}`,style:{animationDelay:`${Math.min(s*.03,.3)}s`},children:[!l&&e.jsx("div",{className:"flex-shrink-0 mr-2 mt-auto",children:n?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold shadow-sm",children:t.authorName?.charAt(0)?.toUpperCase()||"M"}):e.jsx("div",{className:"w-8"})}),e.jsxs("div",{className:`max-w-[75%] ${l?"order-1":""}`,children:[n&&e.jsxs("p",{className:`text-xs font-medium mb-1 ${l?"text-right text-primary/70":"text-gray-500 dark-theme:text-gray-400"}`,children:[l?"You":t.authorName,t.authorRole==="mentor"&&" · Mentor",t.authorRole==="admin"&&" · Admin"]}),e.jsx("div",{className:`rounded-2xl px-4 py-2.5 shadow-sm ${l?"bg-primary text-white rounded-br-md":"bg-gray-100 dark-theme:bg-gray-700 text-gray-900 dark-theme:text-gray-100 rounded-bl-md"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:t.content})}),e.jsx("p",{className:`text-[10px] mt-1 ${l?"text-right":""} text-gray-400 dark-theme:text-gray-500`,children:t._sending?e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("i",{className:"ri-time-line"})," Sending..."]}):H(t.createdAt)})]}),l&&e.jsx("div",{className:"flex-shrink-0 ml-2 mt-auto",children:n?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-pink-500 flex items-center justify-center text-white text-xs font-bold shadow-sm",children:"You"}):e.jsx("div",{className:"w-8"})})]},t.id)})}),e.jsx("div",{ref:R})]}),_&&e.jsx("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 z-10",children:e.jsxs("button",{onClick:()=>h(),className:"bg-primary text-white rounded-full px-4 py-1.5 text-xs shadow-lg hover:bg-primary-dark transition flex items-center gap-1",children:[e.jsx("i",{className:"ri-arrow-down-line"})," New messages"]})}),r.status!=="resolved"&&r.status!=="closed"?e.jsxs("div",{className:"px-4 py-3 border-t dark-theme:border-gray-700 bg-white/80 dark-theme:bg-gray-800/80 backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("textarea",{ref:T,value:x,onChange:t=>p(t.target.value),onKeyDown:G,placeholder:"Type a message...",rows:1,className:"flex-1 px-4 py-2.5 border rounded-2xl dark-theme:bg-gray-700 dark-theme:border-gray-600 dark-theme:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none text-sm max-h-32 overflow-y-auto",style:{minHeight:"42px"},onInput:t=>{t.target.style.height="auto",t.target.style.height=Math.min(t.target.scrollHeight,128)+"px"}}),e.jsx("button",{onClick:E,disabled:!x.trim()||y,className:`p-2.5 rounded-full transition shadow-sm flex-shrink-0 ${x.trim()&&!y?"bg-primary text-white hover:bg-primary-dark hover:shadow-md":"bg-gray-200 dark-theme:bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:y?e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg"}):e.jsx("i",{className:"ri-send-plane-2-fill text-lg"})})]}),e.jsx("p",{className:"text-[10px] text-gray-400 dark-theme:text-gray-500 mt-1.5 text-center",children:"Press Enter to send · Shift+Enter for new line"})]}):e.jsxs("div",{className:"px-4 py-3 border-t dark-theme:border-gray-700 text-center text-sm text-gray-400 dark-theme:text-gray-500 bg-gray-50 dark-theme:bg-gray-900/30",children:[e.jsx("i",{className:"ri-check-double-line mr-1"})," This conversation has been ",r.status]})]})]})]}):e.jsx(P,{children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark-theme:text-gray-100",children:"My Doubts"}),e.jsx("p",{className:"text-gray-500 dark-theme:text-gray-400 text-sm mt-1",children:"Ask questions and get help from mentors"})]}),e.jsxs("button",{onClick:U,className:"px-5 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark transition shadow-lg hover:shadow-xl font-medium",children:[e.jsx("i",{className:"ri-add-line mr-1"}),"Ask a Doubt"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white dark-theme:bg-gray-800 rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:o.length}),e.jsx("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400",children:"Total Doubts"})]}),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-800 rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:o.filter(t=>t.status==="open").length}),e.jsx("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400",children:"Awaiting Reply"})]}),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-800 rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.filter(t=>t.status==="in-progress").length}),e.jsx("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400",children:"In Progress"})]}),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-800 rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.filter(t=>t.status==="resolved").length}),e.jsx("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400",children:"Resolved"})]})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:["all","open","in-progress","resolved","closed"].map(t=>e.jsxs("button",{onClick:()=>Y(t),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition ${w===t?"bg-primary text-white shadow":"bg-white dark-theme:bg-gray-800 text-gray-600 dark-theme:text-gray-300 hover:bg-gray-50 dark-theme:hover:bg-gray-700 border dark-theme:border-gray-700"}`,children:[t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)," ","(",t==="all"?o.length:o.filter(s=>s.status===t).length,")"]},t))}),u?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("i",{className:"ri-loader-4-line animate-spin text-2xl text-primary"})}):L.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark-theme:bg-gray-800 rounded-xl",children:[e.jsx("i",{className:"ri-question-answer-line text-5xl text-gray-300 dark-theme:text-gray-600 mb-3 block"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark-theme:text-gray-400",children:"No doubts yet"}),e.jsx("p",{className:"text-gray-400 dark-theme:text-gray-500 text-sm mt-1",children:'Click "Ask a Doubt" to post your first question'})]}):e.jsx("div",{className:"space-y-3",children:L.map(t=>e.jsx("div",{onClick:()=>J(t),className:"bg-white dark-theme:bg-gray-800 rounded-xl p-5 shadow-sm hover:shadow-md transition cursor-pointer border border-transparent hover:border-primary/20 dark-theme:hover:border-purple-800 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark-theme:text-gray-100 truncate group-hover:text-primary transition",children:t.title}),e.jsx("span",{className:M(t.priority),children:e.jsx("i",{className:"ri-flag-fill text-sm"})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark-theme:text-gray-400 flex-wrap",children:[t.courseTitle&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-book-open-line mr-1"}),t.courseTitle]}),t.mentorName&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-user-star-line mr-1"}),t.mentorName]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-chat-3-line mr-1"}),t.replyCount||0," replies"]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-time-line mr-1"}),new Date(t.createdAt).toLocaleDateString()]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap ${I(t.status)}`,children:t.status})]})},t.id))})]})})};export{ee as default};
