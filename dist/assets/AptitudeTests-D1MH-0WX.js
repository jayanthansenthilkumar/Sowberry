import{r as a,S as c,g as m,s as p,j as e}from"./index-DWc0sipz.js";import{D as T}from"./DashboardLayout-CZXxrPCJ.js";const f=["All","Quantitative","Logical","Verbal","Technical","Data"],A={Quantitative:"ri-calculator-line",Logical:"ri-brain-line",Verbal:"ri-book-open-line",Technical:"ri-computer-line",Data:"ri-pie-chart-line"},C={Quantitative:"from-blue-500 to-indigo-500",Logical:"from-violet-500 to-purple-500",Verbal:"from-emerald-500 to-green-500",Technical:"from-orange-500 to-red-500",Data:"from-amber-500 to-yellow-500"},F={Easy:"bg-green-500/10 text-green-400",Medium:"bg-amber-500/10 text-amber-400",Hard:"bg-red-500/10 text-red-400"},G=()=>{const[l,$]=a.useState([]),[q,E]=a.useState(!0),[n,I]=a.useState(null),[j,M]=a.useState(null),[x,k]=a.useState({}),[g,v]=a.useState(0),[N,b]=a.useState(!1),[y,D]=a.useState("All"),[o,h]=a.useState(0),[_,L]=a.useState(null),[P,Q]=a.useState([]);a.useEffect(()=>{(async()=>{try{const r=await p.getAptitudeTests();r.success&&$(r.tests||[])}catch(r){console.error("Fetch tests error:",r)}E(!1)})()},[]),a.useEffect(()=>{if(!n||g<=0)return;const t=setInterval(()=>v(r=>r<=1?(clearInterval(t),R(),0):r-1),1e3);return()=>clearInterval(t)},[n,g]);const O=async t=>{try{const r=await p.startAptitudeTest(t);r.success?(I({...r.test,questions:r.questions||[]}),M(r.attemptId),k({}),h(0),L(null),Q([]),v((r.test.duration||30)*60)):c.fire({...m(),icon:"error",title:"Error",text:r.message})}catch{c.fire({...m(),icon:"error",title:"Error",text:"Failed to start test. Please try again."})}},R=()=>w(!0),w=async(t=!1)=>{if(!t&&!(await c.fire({...m(),title:"Submit Test?",text:"You cannot change answers after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonColor:"#333"})).isConfirmed)return;b(!0);const r=n.questions||[],i=r.map(s=>({questionId:s.id,selectedOption:x[s.id]||null}));try{const s=await p.submitAptitudeTest(j,{answers:i.filter(d=>d.selectedOption)});if(b(!1),s.success){const d=s.totalMarks||r.length,u=s.score||0;c.fire({...m(),icon:u>=d*.7?"success":u>=d*.4?"info":"warning",title:t?"Time's Up!":"Test Submitted!",text:`Score: ${u}/${d} (${Math.round(u/d*100)}%)`,timer:2e3,showConfirmButton:!1}).then(()=>{window.location.href=`/student/aptitude-tests/result/${j}`})}else c.fire({...m(),icon:"error",title:"Error",text:s.message})}catch{b(!1),c.fire({...m(),icon:"error",title:"Error",text:"Failed to submit test."})}},B=t=>`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`,S=y==="All"?l:l.filter(t=>t.category===y);if(n){const t=n.questions||[],r=t[o];return e.jsx(T,{pageTitle:"Aptitude Test",role:"student",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-4 border border-sand dark-theme:border-gray-800 sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-800 dark-theme:text-gray-100 text-sm",children:n.title}),e.jsxs("p",{className:"text-[11px] text-gray-500 dark-theme:text-gray-400",children:[Object.keys(x).length,"/",t.length," answered"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`text-lg font-mono font-bold ${g<60?"text-red-500 animate-pulse":"text-primary"}`,children:[e.jsx("i",{className:"ri-time-line mr-1"}),B(g)]}),e.jsx("button",{onClick:()=>w(),disabled:N,className:"px-4 py-2 rounded-xl bg-primary text-white text-xs font-semibold hover:bg-primary-dark disabled:opacity-50 transition-colors",children:N?"Submitting...":"Submit"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-3",children:t.map((i,s)=>e.jsx("button",{onClick:()=>h(s),className:`w-7 h-7 rounded-lg text-[10px] font-bold transition-colors ${o===s?"bg-primary text-white":x[t[s].id]!==void 0?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-cream dark-theme:bg-gray-800 text-gray-500 dark-theme:text-gray-400 border border-sand dark-theme:border-gray-700"}`,children:s+1},s))})]}),r&&e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-6 border border-sand dark-theme:border-gray-800",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"w-8 h-8 rounded-xl bg-primary/15 flex items-center justify-center text-sm font-bold text-primary flex-shrink-0",children:o+1}),e.jsx("p",{className:"text-gray-800 dark-theme:text-gray-100 font-medium leading-relaxed",children:r.question})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2.5 ml-11",children:["A","B","C","D"].map(i=>e.jsxs("button",{onClick:()=>k({...x,[r.id]:i}),className:`p-4 rounded-xl text-sm text-left transition-all border ${x[r.id]===i?"border-primary bg-primary/10 text-primary font-medium":"border-sand dark-theme:border-gray-800 text-gray-500 dark-theme:text-gray-400 hover:border-gray-400 dark-theme:hover:border-gray-600 hover:text-gray-800 dark-theme:hover:text-gray-100"}`,children:[e.jsxs("span",{className:"font-bold mr-3 text-xs opacity-60",children:[i,"."]}),r[`option${i}`]]},i))}),e.jsxs("p",{className:"ml-11 mt-3 text-[10px] text-gray-400 dark-theme:text-gray-500",children:[r.marks||1," mark",(r.marks||1)>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>h(i=>Math.max(0,i-1)),disabled:o===0,className:"px-4 py-2 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 text-gray-500 dark-theme:text-gray-400 text-xs font-medium hover:bg-cream-dark dark-theme:hover:bg-gray-700 disabled:opacity-30 transition-colors",children:[e.jsx("i",{className:"ri-arrow-left-line mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-xs text-gray-400 dark-theme:text-gray-500",children:[o+1," of ",t.length]}),e.jsxs("button",{onClick:()=>h(i=>Math.min(t.length-1,i+1)),disabled:o>=t.length-1,className:"px-4 py-2 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 text-gray-500 dark-theme:text-gray-400 text-xs font-medium hover:bg-cream-dark dark-theme:hover:bg-gray-700 disabled:opacity-30 transition-colors",children:["Next",e.jsx("i",{className:"ri-arrow-right-line ml-1"})]})]})]})})}return e.jsx(T,{pageTitle:"Aptitude Tests",role:"student",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark-theme:text-gray-100",children:"Aptitude Tests"}),e.jsxs("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400 mt-1",children:[l.length," tests available across ",f.length-1," categories"]})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:f.map(t=>e.jsxs("button",{onClick:()=>D(t),className:`px-4 py-2 rounded-xl text-xs font-medium transition-colors ${y===t?"bg-primary text-white":"bg-cream dark-theme:bg-gray-800 text-gray-500 dark-theme:text-gray-500 border border-sand dark-theme:border-gray-700 hover:border-gray-400 dark-theme:hover:border-gray-600"}`,children:[t!=="All"&&e.jsx("i",{className:`${A[t]} mr-1`}),t]},t))}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{label:"Total Tests",value:l.length,icon:"ri-file-list-3-line",color:"text-primary"},{label:"Questions",value:l.reduce((t,r)=>t+(r.totalQuestions||0),0),icon:"ri-question-line",color:"text-blue-400"},{label:"Attempted",value:l.filter(t=>t.myAttempts>0).length,icon:"ri-check-double-line",color:"text-green-400"},{label:"Categories",value:[...new Set(l.map(t=>t.category).filter(Boolean))].length||f.length-1,icon:"ri-folder-line",color:"text-violet-400"}].map((t,r)=>e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-4 border border-sand dark-theme:border-gray-800 flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl bg-cream dark-theme:bg-gray-800 flex items-center justify-center ${t.color}`,children:e.jsx("i",{className:`${t.icon} text-lg`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-gray-800 dark-theme:text-gray-100",children:t.value}),e.jsx("p",{className:"text-[10px] text-gray-500 dark-theme:text-gray-400",children:t.label})]})]},r))}),q?null:S.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-400 dark-theme:text-gray-500",children:[e.jsx("i",{className:"ri-question-answer-line text-4xl mb-3 block"}),e.jsx("p",{children:"No tests in this category"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(t=>{const r=t.bestScore!==null&&t.totalMarks?Math.round(t.bestScore/t.totalMarks*100):null;return e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl border border-sand dark-theme:border-gray-800 overflow-hidden hover:border-primary/30 hover:shadow-lg hover:shadow-primary/5 transition-all group",children:[e.jsx("div",{className:`h-1.5 bg-gradient-to-r ${C[t.category]||"from-gray-500 to-gray-600"}`}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-r ${C[t.category]||"from-gray-500 to-gray-600"} flex items-center justify-center group-hover:scale-110 transition-transform`,children:e.jsx("i",{className:`${t.icon||A[t.category]||"ri-question-answer-line"} text-white text-lg`})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.difficulty&&e.jsx("span",{className:`text-[10px] font-medium px-2 py-1 rounded-full ${F[t.difficulty]||""}`,children:t.difficulty}),t.myAttempts>0&&e.jsxs("span",{className:"text-[10px] font-medium px-2 py-1 rounded-full bg-blue-500/10 text-blue-400",children:[t.myAttempts," attempt",t.myAttempts>1?"s":""]})]})]}),e.jsx("h3",{className:"font-bold text-gray-800 dark-theme:text-gray-100 text-sm mb-1",children:t.title}),e.jsx("p",{className:"text-[11px] text-gray-500 dark-theme:text-gray-400 line-clamp-2 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 text-[11px] text-gray-400 dark-theme:text-gray-500 mb-4",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-time-line mr-0.5"}),t.duration," min"]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-file-list-line mr-0.5"}),t.totalQuestions," Q"]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-medal-line mr-0.5"}),t.totalMarks," marks"]})]}),r!==null&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] mb-1",children:[e.jsx("span",{className:"text-gray-500 dark-theme:text-gray-400",children:"Best Score"}),e.jsxs("span",{className:r>=70?"text-green-400":"text-amber-400",children:[r,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-cream dark-theme:bg-gray-800 rounded-full",children:e.jsx("div",{className:`h-full rounded-full ${r>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${r}%`}})})]}),e.jsxs("button",{onClick:()=>O(t.id),className:"w-full py-2.5 rounded-xl bg-primary text-white text-xs font-semibold hover:bg-primary-dark transition-colors",children:[e.jsx("i",{className:"ri-play-line mr-1"}),t.myAttempts>0?"Retake":"Start Test"]})]})]},t.id)})})]})})};export{G as default};
