import{f as B,u as V,r as n,j as e,s as k,S as A,g as G}from"./index-Ci2oCG6z.js";import{D as m}from"./DashboardLayout-DRLhpPhO.js";const O=()=>{const{id:x}=B(),g=V(),[r,w]=n.useState(null),[C,h]=n.useState(null),[T,y]=n.useState(!0),[s,u]=n.useState(null),[p,b]=n.useState({}),[i,j]=n.useState([]),D=async()=>{y(!0);const t=await k.getCourseView(x);if(t.success){const a=t.course,l=a?.enrollment||null;w(a),h(l),j(l?.completedTopics||[]),a?.subjects?.length>0&&b({[a.subjects[0].id]:!0}),a?.content?.length>0&&u(a.content[0])}else A.fire({...G(),icon:"error",title:"Error",text:t.message||"Could not load course"});y(!1)};n.useEffect(()=>{D()},[x]);const S=t=>{b(a=>({...a,[t]:!a[t]}))},$=async t=>{let a;i.includes(t)?a=i.filter(d=>d!==t):a=[...i,t],j(a);const l=(r?.subjects||[]).reduce((d,P)=>d+(P.topics?.length||0),0),c=l>0?Math.round(a.length/l*100):0;(await k.updateCourseProgress(x,{progress:c,completedTopics:a})).success&&h(d=>({...d,completionPercentage:c}))},E=(r?.subjects||[]).reduce((t,a)=>t+(a.topics?.length||0),0),f=C?.completionPercentage||0,N={video:"ri-play-circle-line",pdf:"ri-file-pdf-2-line",text:"ri-file-text-line"},v={video:"text-blue-500 bg-blue-500/10",pdf:"text-red-500 bg-red-500/10",text:"text-green-500 bg-green-500/10"};return T?e.jsx(m,{pageTitle:"Course Viewer",role:"student",children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("i",{className:"ri-loader-4-line animate-spin text-2xl text-primary"})})}):r?e.jsx(m,{pageTitle:r.title,role:"student",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>g("/student/my-courses"),className:"w-8 h-8 rounded-lg bg-gray-100 dark-theme:bg-gray-800 flex items-center justify-center hover:bg-gray-200 dark-theme:hover:bg-gray-700",children:e.jsx("i",{className:"ri-arrow-left-line text-gray-600 dark-theme:text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-800 dark-theme:text-gray-100",children:r.title}),e.jsxs("p",{className:"text-xs text-gray-400",children:[r.mentorName&&`By ${r.mentorName} • `,r.category||"General"," • ",r.courseType||"Theory"]})]})]}),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-4 border border-sand dark-theme:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600 dark-theme:text-gray-400",children:"Course Progress"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400",children:[e.jsxs("span",{children:[i.length,"/",E," topics"]}),e.jsxs("span",{className:"font-bold text-primary",children:[f,"%"]})]})]}),e.jsx("div",{className:"w-full h-2.5 bg-gray-200 dark-theme:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-dark rounded-full transition-all duration-500",style:{width:`${f}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-700 dark-theme:text-gray-300 px-1",children:"Course Structure"}),(r.subjects||[]).length===0?e.jsx("div",{className:"bg-white dark-theme:bg-gray-900 rounded-xl p-4 border border-sand dark-theme:border-gray-800 text-center",children:e.jsx("p",{className:"text-xs text-gray-400",children:"No units available"})}):(r.subjects||[]).map((t,a)=>e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-xl border border-sand dark-theme:border-gray-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>S(t.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark-theme:hover:bg-gray-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary/10 text-primary text-[10px] font-bold flex items-center justify-center",children:a+1}),e.jsx("span",{className:"text-sm font-medium text-gray-800 dark-theme:text-gray-100 text-left",children:t.title})]}),e.jsx("i",{className:`ri-arrow-${p[t.id]?"up":"down"}-s-line text-gray-400`})]}),p[t.id]&&(t.topics||[]).length>0&&e.jsx("div",{className:"px-3 pb-3 space-y-1",children:t.topics.map((l,c)=>{const o=i.includes(l.id);return e.jsxs("div",{className:"flex items-center gap-2 pl-8 py-1.5 group",children:[e.jsx("button",{onClick:()=>$(l.id),className:`w-5 h-5 rounded-md border-2 flex items-center justify-center flex-shrink-0 transition-colors ${o?"bg-green-500/100 border-green-500 text-white":"border-gray-300 dark-theme:border-gray-600 hover:border-primary"}`,children:o&&e.jsx("i",{className:"ri-check-line text-xs"})}),e.jsxs("span",{className:`text-xs ${o?"text-gray-400 line-through":"text-gray-700 dark-theme:text-gray-300"}`,children:[a+1,".",c+1," ",l.title]})]},l.id)})})]},t.id)),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-xl p-4 border border-sand dark-theme:border-gray-800 space-y-2",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-600 dark-theme:text-gray-400 uppercase",children:"Course Info"}),r.courseCode&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Code"}),e.jsx("span",{className:"text-gray-700 dark-theme:text-gray-300",children:r.courseCode})]}),r.difficulty&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Difficulty"}),e.jsx("span",{className:"text-gray-700 dark-theme:text-gray-300 capitalize",children:r.difficulty})]}),r.duration&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Duration"}),e.jsx("span",{className:"text-gray-700 dark-theme:text-gray-300",children:r.duration})]}),r.semester&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Semester"}),e.jsx("span",{className:"text-gray-700 dark-theme:text-gray-300",children:r.semester})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Content"}),e.jsxs("span",{className:"text-gray-700 dark-theme:text-gray-300",children:[(r.content||[]).length," items"]})]})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-4",children:(r.content||[]).length===0?e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-12 border border-sand dark-theme:border-gray-800 text-center",children:[e.jsx("i",{className:"ri-folder-open-line text-5xl text-gray-300 mb-3 block"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No content available for this course yet"})]}):e.jsxs(e.Fragment,{children:[s&&e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl border border-sand dark-theme:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-sand dark-theme:border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800 dark-theme:text-gray-100 text-sm",children:s.title}),e.jsxs("p",{className:"text-[11px] text-gray-400 mt-0.5",children:[s.subjectTitle||"General"," • ",s.contentType]})]}),e.jsx("span",{className:`w-8 h-8 rounded-lg ${v[s.contentType]||"bg-gray-100 text-gray-500"} flex items-center justify-center`,children:e.jsx("i",{className:`${N[s.contentType]||"ri-file-line"} text-lg`})})]}),e.jsxs("div",{className:"p-5",children:[s.contentType==="video"&&s.contentData&&e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:s.contentData.includes("youtube")||s.contentData.includes("youtu.be")?e.jsx("iframe",{src:s.contentData.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"absolute inset-0 w-full h-full rounded-xl",frameBorder:"0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"}):e.jsx("video",{src:s.contentData,controls:!0,className:"absolute inset-0 w-full h-full rounded-xl object-contain bg-black"})}),s.contentType==="pdf"&&s.contentData&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("a",{href:s.contentData,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs font-medium hover:bg-red-500/20 inline-flex items-center gap-1.5 transition-colors",children:[e.jsx("i",{className:"ri-external-link-line"}),"Open in Tab"]})}),e.jsx("div",{className:"rounded-xl overflow-hidden border border-sand dark-theme:border-gray-800",style:{height:"75vh"},children:e.jsx("iframe",{src:s.contentData,title:s.title,className:"w-full h-full border-0"})})]}),s.contentType==="text"&&e.jsx("div",{className:"prose prose-sm dark-theme:prose-invert max-w-none",children:e.jsx("div",{className:"bg-cream dark-theme:bg-gray-800 rounded-xl p-5 text-sm text-gray-700 dark-theme:text-gray-300 leading-relaxed whitespace-pre-wrap",children:s.contentData})}),s.description&&e.jsx("p",{className:"mt-4 text-xs text-gray-500 border-t border-sand dark-theme:border-gray-800 pt-3",children:s.description})]})]}),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl border border-sand dark-theme:border-gray-800",children:[e.jsx("div",{className:"px-5 py-3 border-b border-sand dark-theme:border-gray-800",children:e.jsxs("h3",{className:"text-sm font-bold text-gray-700 dark-theme:text-gray-300",children:["All Content (",(r.content||[]).length,")"]})}),e.jsx("div",{className:"divide-y divide-sand dark-theme:divide-gray-800",children:(r.content||[]).map(t=>e.jsxs("button",{onClick:()=>u(t),className:`w-full px-5 py-3 flex items-center gap-3 text-left hover:bg-gray-50 dark-theme:hover:bg-gray-800/50 transition-colors ${s?.id===t.id?"bg-primary/5 dark-theme:bg-primary/10":""}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${v[t.contentType]||"bg-gray-100 text-gray-500"}`,children:e.jsx("i",{className:`${N[t.contentType]||"ri-file-line"} text-sm`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium truncate ${s?.id===t.id?"text-primary":"text-gray-700 dark-theme:text-gray-300"}`,children:t.title}),e.jsx("p",{className:"text-[10px] text-gray-400",children:t.subjectTitle||"General"})]}),s?.id===t.id&&e.jsx("i",{className:"ri-play-fill text-primary"})]},t.id))})]})]})})]})]})}):e.jsx(m,{pageTitle:"Course Viewer",role:"student",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("i",{className:"ri-error-warning-line text-5xl text-gray-300 mb-4 block"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Course not found or not accessible"}),e.jsx("button",{onClick:()=>g("/student/my-courses"),className:"px-4 py-2 rounded-xl bg-primary text-white text-sm",children:"Back to Courses"})]})})};export{O as default};
