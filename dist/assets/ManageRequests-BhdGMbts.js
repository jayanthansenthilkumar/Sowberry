import{r as a,d as m,j as t,S as l,g as n}from"./index-CMem4MGR.js";import{A as v}from"./AdminLayout-C4jwOaZp.js";const $=()=>{const[i,b]=a.useState([]),[f,g]=a.useState(!0),[d,y]=a.useState("all"),[o,j]=a.useState("all"),[R,A]=a.useState(null),[C,S]=a.useState("");a.useEffect(()=>{c()},[]);const c=async()=>{g(!0);const e=await m.getProfileRequests();e.success&&b(e.requests||[]),g(!1)},N=async e=>{const r=await l.fire({...n(),title:"Approve Request?",text:"This will apply the requested changes.",icon:"question",showCancelButton:!0,confirmButtonText:"Approve",confirmButtonColor:"#22c55e",input:"textarea",inputLabel:"Admin Note (optional)",inputPlaceholder:"Add a note for the student..."});if(!r.isConfirmed)return;const s=await m.approveProfileRequest(e,{adminNote:r.value||""});s.success?(l.fire({...n(),icon:"success",title:"Approved!",text:s.message,timer:2e3,showConfirmButton:!1}),c()):l.fire({...n(),icon:"error",title:"Error",text:s.message})},k=async e=>{const r=await l.fire({...n(),title:"Reject Request?",icon:"warning",showCancelButton:!0,confirmButtonText:"Reject",confirmButtonColor:"#ef4444",input:"textarea",inputLabel:"Reason for rejection (required)",inputPlaceholder:"Explain why this request is rejected...",inputValidator:u=>{if(!u||!u.trim())return"Please provide a reason for rejection."}});if(!r.isConfirmed)return;const s=await m.rejectProfileRequest(e,{adminNote:r.value.trim()});s.success?(l.fire({...n(),icon:"success",title:"Rejected",timer:1500,showConfirmButton:!1}),c()):l.fire({...n(),icon:"error",title:"Error",text:s.message})},p=e=>e?new Date(e).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”",w={pending:"bg-yellow-100 text-yellow-700 dark-theme:bg-yellow-900/30 dark-theme:text-yellow-400",approved:"bg-green-100 text-green-700 dark-theme:bg-green-900/30 dark-theme:text-green-400",rejected:"bg-red-100 text-red-700 dark-theme:bg-red-900/30 dark-theme:text-red-400"},h=i.filter(e=>!(d!=="all"&&e.status!==d||o!=="all"&&e.type!==o)),x=i.filter(e=>e.status==="pending").length;return t.jsx(v,{pageTitle:"Manage Requests",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total Requests",count:i.length,icon:"ri-file-list-3-line",color:"text-blue-600 bg-blue-100 dark-theme:bg-blue-900/30 dark-theme:text-blue-400"},{label:"Pending",count:x,icon:"ri-time-line",color:"text-yellow-600 bg-yellow-100 dark-theme:bg-yellow-900/30 dark-theme:text-yellow-400"},{label:"Approved",count:i.filter(e=>e.status==="approved").length,icon:"ri-check-line",color:"text-green-600 bg-green-100 dark-theme:bg-green-900/30 dark-theme:text-green-400"},{label:"Rejected",count:i.filter(e=>e.status==="rejected").length,icon:"ri-close-line",color:"text-red-600 bg-red-100 dark-theme:bg-red-900/30 dark-theme:text-red-400"}].map(e=>t.jsx("div",{className:"bg-white dark-theme:bg-gray-900 rounded-xl border border-sand dark-theme:border-gray-800 p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${e.color}`,children:t.jsx("i",{className:`${e.icon} text-lg`})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-gray-800 dark-theme:text-white",children:e.count}),t.jsx("p",{className:"text-[11px] text-gray-500 dark-theme:text-gray-400",children:e.label})]})]})},e.label))}),t.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[t.jsx("div",{className:"flex gap-1 bg-white dark-theme:bg-gray-900 rounded-lg border border-sand dark-theme:border-gray-800 p-1",children:["all","pending","approved","rejected"].map(e=>t.jsxs("button",{onClick:()=>y(e),className:`px-3 py-1.5 rounded-md text-[12px] font-medium transition-all ${d===e?"bg-primary text-white":"text-gray-500 dark-theme:text-gray-400 hover:bg-cream dark-theme:hover:bg-gray-800"}`,children:[e.charAt(0).toUpperCase()+e.slice(1),e==="pending"&&x>0&&t.jsxs("span",{className:"ml-1 text-[10px]",children:["(",x,")"]})]},e))}),t.jsx("div",{className:"flex gap-1 bg-white dark-theme:bg-gray-900 rounded-lg border border-sand dark-theme:border-gray-800 p-1",children:["all","edit","delete"].map(e=>t.jsx("button",{onClick:()=>j(e),className:`px-3 py-1.5 rounded-md text-[12px] font-medium transition-all ${o===e?"bg-primary text-white":"text-gray-500 dark-theme:text-gray-400 hover:bg-cream dark-theme:hover:bg-gray-800"}`,children:e==="all"?"All Types":e==="edit"?"Edit Requests":"Delete Requests"},e))})]}),t.jsx("div",{className:"space-y-4",children:f?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"})}):h.length===0?t.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-xl border border-sand dark-theme:border-gray-800 p-12 text-center",children:[t.jsx("i",{className:"ri-file-list-3-line text-4xl text-gray-300 dark-theme:text-gray-600"}),t.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"No requests found"})]}):h.map(e=>t.jsx("div",{className:`bg-white dark-theme:bg-gray-900 rounded-xl border ${e.status==="pending"?"border-yellow-300 dark-theme:border-yellow-800":"border-sand dark-theme:border-gray-800"} p-5 transition-all hover:shadow-sm`,children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 lg:w-56 shrink-0",children:[t.jsx("img",{src:e.studentImage?`http://localhost:5000${e.studentImage}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(e.studentName||"Student")}&size=40&background=c96442&color=fff&bold=true`,alt:e.studentName,className:"w-10 h-10 rounded-lg object-cover"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[13px] font-semibold text-gray-800 dark-theme:text-white",children:e.studentName}),t.jsx("p",{className:"text-[11px] text-gray-400",children:e.studentEmail}),e.rollNumber&&t.jsx("p",{className:"text-[10px] text-gray-400",children:e.rollNumber})]})]}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:`px-2 py-0.5 text-[11px] font-semibold rounded-full ${w[e.status]}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),t.jsx("span",{className:`px-2 py-0.5 text-[11px] font-semibold rounded-full ${e.type==="edit"?"bg-blue-100 text-blue-700 dark-theme:bg-blue-900/30 dark-theme:text-blue-400":"bg-red-100 text-red-700 dark-theme:bg-red-900/30 dark-theme:text-red-400"}`,children:e.type==="edit"?"Profile Edit":"Account Deletion"}),t.jsx("span",{className:"text-[11px] text-gray-400",children:p(e.createdAt)})]}),t.jsxs("p",{className:"text-[13px] text-gray-600 dark-theme:text-gray-300",children:[t.jsx("strong",{children:"Reason:"})," ",e.reason]}),e.type==="edit"&&e.requestData&&t.jsxs("div",{className:"p-2.5 bg-gray-50 dark-theme:bg-gray-800/50 rounded-lg",children:[t.jsx("p",{className:"text-[11px] font-semibold text-gray-500 dark-theme:text-gray-400 mb-1.5",children:"Requested Changes:"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:Object.entries(typeof e.requestData=="string"?JSON.parse(e.requestData):e.requestData).map(([r,s])=>t.jsxs("span",{className:"px-2 py-1 bg-white dark-theme:bg-gray-700 border border-sand dark-theme:border-gray-600 rounded text-[11px] text-gray-600 dark-theme:text-gray-300",children:[t.jsxs("strong",{className:"text-gray-800 dark-theme:text-gray-200",children:[r,":"]})," ",s||"(empty)"]},r))})]}),e.adminNote&&t.jsxs("p",{className:"text-[12px] text-gray-500 dark-theme:text-gray-400 italic",children:[t.jsx("i",{className:"ri-chat-quote-line mr-1"}),"Admin note: ",e.adminNote]}),e.reviewerName&&t.jsxs("p",{className:"text-[11px] text-gray-400",children:["Reviewed by ",e.reviewerName," on ",p(e.reviewedAt)]})]}),e.status==="pending"&&t.jsxs("div",{className:"flex lg:flex-col gap-2 shrink-0",children:[t.jsxs("button",{onClick:()=>N(e.id),className:"flex-1 lg:flex-none px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-[12px] font-semibold rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[t.jsx("i",{className:"ri-check-line text-sm"})," Approve"]}),t.jsxs("button",{onClick:()=>k(e.id),className:"flex-1 lg:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-[12px] font-semibold rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[t.jsx("i",{className:"ri-close-line text-sm"})," Reject"]})]})]})},e.id))})]})})};export{$ as default};
