import{r as d,j as t,d as c,S as i,g as u}from"./index-Ci2oCG6z.js";import{A as S}from"./AdminLayout-DUJX2VlJ.js";import{D as C}from"./DataTable-Bd7QzLZh.js";import"./exportData-BhRp0csh.js";import"./jspdf.es.min-Do-SSO7r.js";const I=()=>{const[b,p]=d.useState([]),[h,x]=d.useState(!0),[f,n]=d.useState(!1),[o,g]=d.useState(null),[a,l]=d.useState({email:"",username:"",fullName:"",phone:"",password:""}),m=async()=>{x(!0);const e=await c.getStudents("");e.success&&p(e.students||[]),x(!1)};d.useEffect(()=>{m()},[]);const y=()=>{g(null),l({email:"",username:"",fullName:"",phone:"",password:""}),n(!0)},k=e=>{g(e),l({email:e.email,username:e.username,fullName:e.fullName,phone:e.phone||"",password:""}),n(!0)},N=async e=>{if(e.preventDefault(),o){const r={...a};r.password||delete r.password;const s=await c.updateStudent(o.id,r);s.success?(i.fire({...u(),icon:"success",title:"Updated!",timer:1500,showConfirmButton:!1}),n(!1),m()):i.fire({...u(),icon:"error",title:"Error",text:s.message})}else{const r=await c.createStudent({...a,role:"student"});r.success?(i.fire({...u(),icon:"success",title:"Student Created!",timer:1500,showConfirmButton:!1}),n(!1),m()):i.fire({...u(),icon:"error",title:"Error",text:r.message})}},w=(e,r)=>{i.fire({...u(),title:"Delete Student?",text:`Remove ${r}? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",confirmButtonText:"Delete"}).then(async s=>{s.isConfirmed&&(await c.deleteStudent(e)).success&&(i.fire({...u(),icon:"success",title:"Deleted!",timer:1500,showConfirmButton:!1}),m())})},j=async e=>{(await c.updateStudent(e.id,{isActive:!e.isActive})).success&&m()},v=[{key:"id",label:"ID",sortable:!0,visible:!0},{key:"fullName",label:"Name",sortable:!0,render:(e,r)=>t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("img",{src:r.profileImage?`http://localhost:5000${r.profileImage}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(r.fullName)}&size=36&background=c96442&color=fff`,className:"w-8 h-8 rounded-lg object-cover",alt:""}),t.jsx("span",{className:"font-medium text-gray-800 dark-theme:text-gray-200",children:r.fullName})]}),exportValue:e=>e.fullName},{key:"username",label:"Username",sortable:!0,visible:!1,render:e=>t.jsxs("span",{className:"text-gray-500",children:["@",e]})},{key:"email",label:"Email",sortable:!0},{key:"phone",label:"Phone",sortable:!1,render:e=>e||"—"},{key:"college",label:"College",sortable:!0,render:e=>t.jsx("span",{className:"max-w-[180px] truncate block",title:e||"",children:e||"—"}),exportValue:e=>e.college||"—"},{key:"department",label:"Department",sortable:!0,render:e=>e||"—"},{key:"year",label:"Year",sortable:!0,visible:!1,render:e=>e||"—"},{key:"rollNumber",label:"Roll No",sortable:!0,render:e=>e||"—"},{key:"gender",label:"Gender",sortable:!0,visible:!1,render:e=>e||"—"},{key:"dateOfBirth",label:"DOB",sortable:!0,visible:!1,render:e=>e?new Date(e).toLocaleDateString():"—",exportValue:e=>e.dateOfBirth?new Date(e.dateOfBirth).toLocaleDateString():"—"},{key:"enrolledCourses",label:"Courses",sortable:!0,visible:!1,render:e=>t.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700 dark-theme:bg-blue-900/30 dark-theme:text-blue-400",children:e||0})},{key:"isVerified",label:"Verified",sortable:!0,visible:!1,render:e=>t.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${e?"bg-green-100 text-green-700 dark-theme:bg-green-900/30 dark-theme:text-green-400":"bg-amber-100 text-amber-700 dark-theme:bg-amber-900/30 dark-theme:text-amber-400"}`,children:e?"Yes":"No"}),exportValue:e=>e.isVerified?"Yes":"No"},{key:"isActive",label:"Status",sortable:!0,render:(e,r)=>t.jsx("button",{onClick:s=>{s.stopPropagation(),j(r)},className:`px-2.5 py-1 rounded-full text-xs font-medium ${r.isActive?"bg-green-100 text-green-700 dark-theme:bg-green-900/30 dark-theme:text-green-400":"bg-red-100 text-red-700 dark-theme:bg-red-900/30 dark-theme:text-red-400"}`,children:r.isActive?"Active":"Inactive"}),exportValue:e=>e.isActive?"Active":"Inactive"},{key:"createdAt",label:"Joined",sortable:!0,render:e=>new Date(e).toLocaleDateString(),exportValue:e=>new Date(e.createdAt).toLocaleDateString()},{key:"actions",label:"Actions",render:(e,r)=>t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{onClick:s=>{s.stopPropagation(),k(r)},className:"w-8 h-8 rounded-lg bg-blue-50 dark-theme:bg-blue-900/20 text-blue-500 flex items-center justify-center hover:bg-blue-100 transition-colors",title:"Edit",children:t.jsx("i",{className:"ri-edit-line text-sm"})}),t.jsx("button",{onClick:s=>{s.stopPropagation(),w(r.id,r.fullName)},className:"w-8 h-8 rounded-lg bg-red-50 dark-theme:bg-red-900/20 text-red-500 flex items-center justify-center hover:bg-red-100 transition-colors",title:"Delete",children:t.jsx("i",{className:"ri-delete-bin-line text-sm"})})]})}];return t.jsxs(S,{pageTitle:"Manage Students",children:[t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark-theme:text-gray-100",children:"Manage Students"}),t.jsxs("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400 mt-1",children:[b.length," total students"]})]}),t.jsx(C,{columns:v,data:b,loading:h,searchPlaceholder:"Search students...",storageKey:"sowberry_students_cols",exportTitle:"Students Report",exportFileName:"Sowberry_Students",emptyIcon:"ri-user-line",emptyMessage:"No students found",headerActions:t.jsxs("button",{onClick:y,className:"px-4 py-2 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark transition-colors flex items-center gap-2",children:[t.jsx("i",{className:"ri-add-line"})," Add Student"]})})]}),f&&t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-6 w-full max-w-md mx-4 border border-sand dark-theme:border-gray-800",children:[t.jsxs("div",{className:"flex items-center justify-between mb-5",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-800 dark-theme:text-gray-100",children:o?"Edit Student":"Add Student"}),t.jsx("button",{onClick:()=>n(!1),className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark-theme:hover:bg-gray-800 flex items-center justify-center",children:t.jsx("i",{className:"ri-close-line text-lg text-gray-500"})})]}),t.jsxs("form",{onSubmit:N,className:"space-y-3",children:[t.jsx("input",{type:"email",placeholder:"Email",required:!0,value:a.email,onChange:e=>l({...a,email:e.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),t.jsx("input",{type:"text",placeholder:"Username",required:!0,value:a.username,onChange:e=>l({...a,username:e.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),t.jsx("input",{type:"text",placeholder:"Full Name",required:!0,value:a.fullName,onChange:e=>l({...a,fullName:e.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),t.jsx("input",{type:"tel",placeholder:"Phone",value:a.phone,onChange:e=>l({...a,phone:e.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),t.jsx("input",{type:"password",placeholder:o?"New Password (leave blank to keep)":"Password",required:!o,value:a.password,onChange:e=>l({...a,password:e.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 py-2.5 rounded-xl border border-sand dark-theme:border-gray-700 text-sm font-medium text-gray-600 dark-theme:text-gray-400 hover:bg-gray-50 dark-theme:hover:bg-gray-800",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 py-2.5 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark",children:o?"Update":"Create"})]})]})]})})]})};export{I as default};
