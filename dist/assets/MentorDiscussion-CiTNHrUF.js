import{b as D,r as a,j as e,m as i,S as h,g as u}from"./index-DWc0sipz.js";import{A as S}from"./AdminLayout-y2i8b9cG.js";const E=()=>{const{user:C}=D(),[c,j]=a.useState([]),[N,g]=a.useState(!0),[d,o]=a.useState(null),[r,p]=a.useState(null),[k,l]=a.useState(!1),[n,x]=a.useState({title:"",content:""}),[m,y]=a.useState(""),b=async()=>{g(!0);const s=await i.getDiscussions();s.success&&j(s.discussions||[]),g(!1)};a.useEffect(()=>{b()},[]);const f=async s=>{o(s);const t=await i.getDiscussion(s);t.success&&p({...t.discussion,replies:t.replies||[]})},w=async s=>{s.preventDefault();const t=await i.createDiscussion(n);t.success?(h.fire({...u(),icon:"success",title:"Discussion Created!",timer:1500,showConfirmButton:!1}),l(!1),x({title:"",content:""}),b()):h.fire({...u(),icon:"error",title:"Error",text:t.message})},v=async s=>{if(s.preventDefault(),!m.trim())return;const t=await i.replyDiscussion(d,{content:m});t.success?(y(""),f(d)):h.fire({...u(),icon:"error",title:"Error",text:t.message})};return e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark-theme:text-gray-100",children:"Discussion Forum"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[c.length," threads"]})]}),e.jsxs("button",{onClick:()=>{l(!0),o(null)},className:"px-4 py-2.5 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark flex items-center gap-2",children:[e.jsx("i",{className:"ri-add-line"}),"New Thread"]})]}),d&&r?e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl border border-sand dark-theme:border-gray-800 p-6",children:[e.jsxs("button",{onClick:()=>{o(null),p(null)},className:"text-sm text-primary hover:underline mb-4 flex items-center gap-1",children:[e.jsx("i",{className:"ri-arrow-left-line"}),"Back to threads"]}),e.jsx("h2",{className:"text-lg font-bold text-gray-800 dark-theme:text-gray-100 mb-2",children:r.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-4",children:[e.jsx("span",{children:r.authorName||"Unknown"}),e.jsx("span",{children:"Â·"}),e.jsx("span",{children:r.createdAt?new Date(r.createdAt).toLocaleDateString():""})]}),e.jsx("p",{className:"text-sm text-gray-600 dark-theme:text-gray-300 mb-6 bg-cream dark-theme:bg-gray-800 rounded-xl p-4",children:r.content}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 dark-theme:text-gray-300 text-sm",children:["Replies (",r.replies?.length||0,")"]}),(r.replies||[]).map((s,t)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-cream dark-theme:bg-gray-800 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-xs font-bold text-primary flex-shrink-0",children:(s.authorName||"?")[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700 dark-theme:text-gray-300",children:s.authorName}),e.jsx("span",{className:"text-[10px] text-gray-400",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():""})]}),e.jsx("p",{className:"text-xs text-gray-600 dark-theme:text-gray-400",children:s.content})]})]},t))]}),e.jsxs("form",{onSubmit:v,className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"Write a reply...",value:m,onChange:s=>y(s.target.value),className:"flex-1 px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsx("button",{type:"submit",className:"px-5 py-2.5 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark",children:e.jsx("i",{className:"ri-send-plane-line"})})]})]}):k?e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl border border-sand dark-theme:border-gray-800 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 dark-theme:text-gray-100",children:"New Discussion Thread"}),e.jsx("button",{onClick:()=>l(!1),className:"w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center",children:e.jsx("i",{className:"ri-close-line text-lg text-gray-500"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Thread Title",required:!0,value:n.title,onChange:s=>x({...n,title:s.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsx("textarea",{placeholder:"Write your discussion content...",rows:5,required:!0,value:n.content,onChange:s=>x({...n,content:s.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm resize-none"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 py-2.5 rounded-xl border border-sand text-sm font-medium text-gray-600 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 py-2.5 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark",children:"Post Thread"})]})]})]}):N?null:c.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-400",children:[e.jsx("i",{className:"ri-discuss-line text-4xl mb-3 block"}),e.jsx("p",{children:"No discussions yet. Start a thread!"})]}):e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsx("div",{onClick:()=>f(s.id),className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-5 border border-sand dark-theme:border-gray-800 hover:shadow-md transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"ri-discuss-line text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-800 dark-theme:text-gray-100 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1 mb-2",children:s.content}),e.jsxs("div",{className:"flex items-center gap-3 text-[11px] text-gray-400",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-user-line mr-1"}),s.authorName||"Unknown"]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-chat-3-line mr-1"}),s.replyCount||0," replies"]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-time-line mr-1"}),s.createdAt?new Date(s.createdAt).toLocaleDateString():""]})]})]}),e.jsx("i",{className:"ri-arrow-right-s-line text-gray-400"})]})},s.id))})]})})};export{E as default};
