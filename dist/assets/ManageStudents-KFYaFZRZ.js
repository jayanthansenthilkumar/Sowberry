import{r as l,j as e,d as y,S as m,g as x}from"./index-CHjF_dAl.js";import{A as Q}from"./AdminLayout-CsrdiLzj.js";import{e as W,a as X}from"./exportData-CnZtBtFr.js";const C=[{key:"id",label:"ID"},{key:"fullName",label:"Name"},{key:"username",label:"Username"},{key:"email",label:"Email"},{key:"phone",label:"Phone"},{key:"college",label:"College"},{key:"department",label:"Department"},{key:"year",label:"Year"},{key:"rollNumber",label:"Roll Number"},{key:"gender",label:"Gender"},{key:"dateOfBirth",label:"Date of Birth"},{key:"enrolledCourses",label:"Enrolled Courses"},{key:"isVerified",label:"Verified"},{key:"isActive",label:"Status"},{key:"createdAt",label:"Joined"},{key:"actions",label:"Actions"}],A=["id","fullName","email","phone","college","department","rollNumber","isActive","createdAt","actions"],re=()=>{const[b,I]=l.useState([]),[T,D]=l.useState(!0),[k,P]=l.useState(""),[R,p]=l.useState(!1),[h,E]=l.useState(null),[i,d]=l.useState({email:"",username:"",fullName:"",phone:"",password:""}),[j,B]=l.useState(()=>{try{const t=localStorage.getItem("sowberry_students_cols");return t?JSON.parse(t):A}catch{return A}}),[L,M]=l.useState(!1),[o,g]=l.useState(1),[f,U]=l.useState(0),[w,F]=l.useState(""),N=20,v=l.useRef(null);l.useEffect(()=>{const t=a=>{v.current&&!v.current.contains(a.target)&&M(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),l.useEffect(()=>{localStorage.setItem("sowberry_students_cols",JSON.stringify(j))},[j]);const u=async()=>{D(!0);const t=new URLSearchParams;k&&t.set("search",k),w&&t.set("status",w),t.set("page",o),t.set("limit",N);const a=await y.getStudents(t.toString());a.success&&(I(a.students||[]),U(a.total||0)),D(!1)};l.useEffect(()=>{u()},[o,w]);const _=t=>{t.preventDefault(),g(1),u()},$=t=>{B(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},q=()=>B([...A]),r=t=>j.includes(t),J=()=>{E(null),d({email:"",username:"",fullName:"",phone:"",password:""}),p(!0)},Y=t=>{E(t),d({email:t.email,username:t.username,fullName:t.fullName,phone:t.phone||"",password:""}),p(!0)},z=async t=>{if(t.preventDefault(),h){const a={...i};a.password||delete a.password;const s=await y.updateStudent(h.id,a);s.success?(m.fire({...x(),icon:"success",title:"Updated!",timer:1500,showConfirmButton:!1}),p(!1),u()):m.fire({...x(),icon:"error",title:"Error",text:s.message})}else{const a=await y.createStudent({...i,role:"student"});a.success?(m.fire({...x(),icon:"success",title:"Student Created!",timer:1500,showConfirmButton:!1}),p(!1),u()):m.fire({...x(),icon:"error",title:"Error",text:a.message})}},G=(t,a)=>{m.fire({...x(),title:"Delete Student?",text:`Remove ${a}? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",confirmButtonText:"Delete"}).then(async s=>{s.isConfirmed&&(await y.deleteStudent(t)).success&&(m.fire({...x(),icon:"success",title:"Deleted!",timer:1500,showConfirmButton:!1}),u())})},H=async t=>{(await y.updateStudent(t.id,{isActive:!t.isActive})).success&&u()},O=(t,a)=>{switch(a){case"id":return t.id;case"fullName":return t.fullName;case"username":return t.username;case"email":return t.email;case"phone":return t.phone||"—";case"college":return t.college||"—";case"department":return t.department||"—";case"year":return t.year||"—";case"rollNumber":return t.rollNumber||"—";case"gender":return t.gender||"—";case"dateOfBirth":return t.dateOfBirth?new Date(t.dateOfBirth).toLocaleDateString():"—";case"enrolledCourses":return t.enrolledCourses||0;case"isVerified":return t.isVerified?"Yes":"No";case"isActive":return t.isActive?"Active":"Inactive";case"createdAt":return new Date(t.createdAt).toLocaleDateString();default:return""}},V=()=>{const t=C.filter(n=>n.key!=="actions"&&r(n.key)),a=t.map(n=>n.label),s=b.map(n=>t.map(S=>O(n,S.key)));return{title:"Students Report",columns:a,rows:s,fileName:"Sowberry_Students"}},K=()=>{const t=C.filter(n=>n.key!=="actions"&&r(n.key)),a=t.map(n=>n.label).join("	"),s=b.map(n=>t.map(S=>O(n,S.key)).join("	"));navigator.clipboard.writeText([a,...s].join(`
`)).then(()=>{m.fire({...x(),icon:"success",title:"Copied!",text:"Table data copied to clipboard",timer:1500,showConfirmButton:!1})})},c=Math.ceil(f/N);return e.jsxs(Q,{pageTitle:"Manage Students",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark-theme:text-gray-100",children:"Manage Students"}),e.jsxs("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400 mt-1",children:[f," total students"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("form",{onSubmit:_,className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search students...",value:k,onChange:t=>P(t.target.value),className:"pl-9 pr-4 py-2.5 rounded-xl bg-white dark-theme:bg-gray-900 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm w-56"})]}),e.jsxs("select",{value:w,onChange:t=>{F(t.target.value),g(1)},className:"px-3 py-2.5 rounded-xl bg-white dark-theme:bg-gray-900 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm text-gray-600 dark-theme:text-gray-300",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"unverified",children:"Unverified"})]}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("button",{onClick:()=>M(!L),className:"px-3 py-2.5 rounded-xl bg-white dark-theme:bg-gray-900 border border-sand dark-theme:border-gray-700 text-sm text-gray-600 dark-theme:text-gray-300 hover:border-primary transition-colors flex items-center gap-1.5",children:[e.jsx("i",{className:"ri-layout-column-line text-sm"})," Columns ",e.jsx("i",{className:"ri-arrow-down-s-line text-xs"})]}),L&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-56 bg-white dark-theme:bg-gray-900 border border-sand dark-theme:border-gray-700 rounded-xl shadow-xl z-50 py-1 max-h-80 overflow-y-auto",children:[C.map(t=>e.jsxs("button",{onClick:()=>$(t.key),className:"w-full flex items-center justify-between px-4 py-2.5 text-sm text-gray-700 dark-theme:text-gray-300 hover:bg-cream/50 dark-theme:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{children:t.label}),r(t.key)&&e.jsx("i",{className:"ri-check-line text-primary font-bold"})]},t.key)),e.jsx("div",{className:"border-t border-sand dark-theme:border-gray-700 mt-1 pt-1",children:e.jsx("button",{onClick:q,className:"w-full px-4 py-2.5 text-sm text-primary hover:bg-cream/50 dark-theme:hover:bg-gray-800/50 transition-colors text-left font-medium",children:"Restore visibility"})})]})]}),e.jsxs("button",{onClick:K,className:"px-3 py-2.5 rounded-xl bg-white dark-theme:bg-gray-900 border border-sand dark-theme:border-gray-700 text-sm text-gray-600 dark-theme:text-gray-300 hover:border-primary transition-colors flex items-center gap-1.5",children:[e.jsx("i",{className:"ri-file-copy-line text-sm"})," Copy"]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white dark-theme:bg-gray-900 border border-sand dark-theme:border-gray-700 rounded-xl px-1",children:[e.jsxs("button",{onClick:()=>W(V()),className:"px-3 py-2 rounded-lg text-xs font-medium text-red-500 hover:bg-red-50 dark-theme:hover:bg-red-900/20 transition-colors flex items-center gap-1.5",title:"Download PDF",children:[e.jsx("i",{className:"ri-file-pdf-2-line text-sm"})," PDF"]}),e.jsx("div",{className:"w-px h-5 bg-sand dark-theme:bg-gray-700"}),e.jsxs("button",{onClick:()=>X(V()),className:"px-3 py-2 rounded-lg text-xs font-medium text-green-600 hover:bg-green-50 dark-theme:hover:bg-green-900/20 transition-colors flex items-center gap-1.5",title:"Download Excel",children:[e.jsx("i",{className:"ri-file-excel-2-line text-sm"})," Excel"]})]}),e.jsxs("button",{onClick:J,className:"px-4 py-2.5 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark transition-colors flex items-center gap-2",children:[e.jsx("i",{className:"ri-add-line"})," Add Student"]})]})]}),e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl border border-sand dark-theme:border-gray-800 overflow-hidden",children:[T?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("i",{className:"ri-loader-4-line animate-spin text-2xl text-primary"})}):b.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-400",children:[e.jsx("i",{className:"ri-user-line text-4xl mb-3 block"}),e.jsx("p",{children:"No students found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-sand dark-theme:border-gray-800 bg-cream/50 dark-theme:bg-gray-800/50",children:[r("id")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"ID"}),r("fullName")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Name"}),r("username")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Username"}),r("email")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Email"}),r("phone")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Phone"}),r("college")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"College"}),r("department")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Department"}),r("year")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Year"}),r("rollNumber")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Roll No"}),r("gender")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Gender"}),r("dateOfBirth")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"DOB"}),r("enrolledCourses")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Courses"}),r("isVerified")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Verified"}),r("isActive")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Status"}),r("createdAt")&&e.jsx("th",{className:"text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Joined"}),r("actions")&&e.jsx("th",{className:"text-right px-5 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-sand dark-theme:divide-gray-800",children:b.map(t=>e.jsxs("tr",{className:"hover:bg-cream/30 dark-theme:hover:bg-gray-800/30 transition-colors",children:[r("id")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-500 dark-theme:text-gray-400 whitespace-nowrap",children:t.id}),r("fullName")&&e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("img",{src:t.profileImage?`http://localhost:5000${t.profileImage}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(t.fullName)}&size=36&background=c96442&color=fff`,className:"w-8 h-8 rounded-lg object-cover",alt:""}),e.jsx("span",{className:"text-sm font-medium text-gray-800 dark-theme:text-gray-200",children:t.fullName})]})}),r("username")&&e.jsxs("td",{className:"px-5 py-3 text-sm text-gray-500 dark-theme:text-gray-400 whitespace-nowrap",children:["@",t.username]}),r("email")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.email}),r("phone")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.phone||"—"}),r("college")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap max-w-[200px] truncate",title:t.college||"",children:t.college||"—"}),r("department")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.department||"—"}),r("year")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.year||"—"}),r("rollNumber")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.rollNumber||"—"}),r("gender")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.gender||"—"}),r("dateOfBirth")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-600 dark-theme:text-gray-400 whitespace-nowrap",children:t.dateOfBirth?new Date(t.dateOfBirth).toLocaleDateString():"—"}),r("enrolledCourses")&&e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700 dark-theme:bg-blue-900/30 dark-theme:text-blue-400",children:t.enrolledCourses||0})}),r("isVerified")&&e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.isVerified?"bg-green-100 text-green-700 dark-theme:bg-green-900/30 dark-theme:text-green-400":"bg-amber-100 text-amber-700 dark-theme:bg-amber-900/30 dark-theme:text-amber-400"}`,children:t.isVerified?"Yes":"No"})}),r("isActive")&&e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx("button",{onClick:()=>H(t),className:`px-2.5 py-1 rounded-full text-xs font-medium ${t.isActive?"bg-green-100 text-green-700 dark-theme:bg-green-900/30 dark-theme:text-green-400":"bg-red-100 text-red-700 dark-theme:bg-red-900/30 dark-theme:text-red-400"}`,children:t.isActive?"Active":"Inactive"})}),r("createdAt")&&e.jsx("td",{className:"px-5 py-3 text-sm text-gray-500 whitespace-nowrap",children:new Date(t.createdAt).toLocaleDateString()}),r("actions")&&e.jsx("td",{className:"px-5 py-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Y(t),className:"w-8 h-8 rounded-lg bg-blue-50 dark-theme:bg-blue-900/20 text-blue-500 flex items-center justify-center hover:bg-blue-100 transition-colors",title:"Edit",children:e.jsx("i",{className:"ri-edit-line text-sm"})}),e.jsx("button",{onClick:()=>G(t.id,t.fullName),className:"w-8 h-8 rounded-lg bg-red-50 dark-theme:bg-red-900/20 text-red-500 flex items-center justify-center hover:bg-red-100 transition-colors",title:"Delete",children:e.jsx("i",{className:"ri-delete-bin-line text-sm"})})]})})]},t.id))})]})}),c>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-t border-sand dark-theme:border-gray-800",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark-theme:text-gray-400",children:["Showing ",(o-1)*N+1,"–",Math.min(o*N,f)," of ",f]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g(t=>Math.max(1,t-1)),disabled:o===1,className:"w-8 h-8 rounded-lg flex items-center justify-center text-sm text-gray-500 hover:bg-cream dark-theme:hover:bg-gray-800 disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:e.jsx("i",{className:"ri-arrow-left-s-line"})}),Array.from({length:Math.min(c,5)},(t,a)=>{let s;return c<=5||o<=3?s=a+1:o>=c-2?s=c-4+a:s=o-2+a,e.jsx("button",{onClick:()=>g(s),className:`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-medium transition-colors ${o===s?"bg-primary text-white":"text-gray-500 hover:bg-cream dark-theme:hover:bg-gray-800"}`,children:s},s)}),e.jsx("button",{onClick:()=>g(t=>Math.min(c,t+1)),disabled:o===c,className:"w-8 h-8 rounded-lg flex items-center justify-center text-sm text-gray-500 hover:bg-cream dark-theme:hover:bg-gray-800 disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:e.jsx("i",{className:"ri-arrow-right-s-line"})})]})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white dark-theme:bg-gray-900 rounded-2xl p-6 w-full max-w-md mx-4 border border-sand dark-theme:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 dark-theme:text-gray-100",children:h?"Edit Student":"Add Student"}),e.jsx("button",{onClick:()=>p(!1),className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark-theme:hover:bg-gray-800 flex items-center justify-center",children:e.jsx("i",{className:"ri-close-line text-lg text-gray-500"})})]}),e.jsxs("form",{onSubmit:z,className:"space-y-3",children:[e.jsx("input",{type:"email",placeholder:"Email",required:!0,value:i.email,onChange:t=>d({...i,email:t.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsx("input",{type:"text",placeholder:"Username",required:!0,value:i.username,onChange:t=>d({...i,username:t.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsx("input",{type:"text",placeholder:"Full Name",required:!0,value:i.fullName,onChange:t=>d({...i,fullName:t.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsx("input",{type:"tel",placeholder:"Phone",value:i.phone,onChange:t=>d({...i,phone:t.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsx("input",{type:"password",placeholder:h?"New Password (leave blank to keep)":"Password",required:!h,value:i.password,onChange:t=>d({...i,password:t.target.value}),className:"w-full px-4 py-2.5 rounded-xl bg-cream dark-theme:bg-gray-800 border border-sand dark-theme:border-gray-700 focus:border-primary outline-none text-sm"}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 py-2.5 rounded-xl border border-sand dark-theme:border-gray-700 text-sm font-medium text-gray-600 dark-theme:text-gray-400 hover:bg-gray-50 dark-theme:hover:bg-gray-800",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 py-2.5 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-dark",children:h?"Update":"Create"})]})]})]})})]})};export{re as default};
